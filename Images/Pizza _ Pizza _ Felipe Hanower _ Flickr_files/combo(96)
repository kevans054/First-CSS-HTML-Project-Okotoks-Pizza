YUI.add("hermes-template-photo-sidebar-actions",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,n,l){var r;return e.escapeExpression((t.formatNumber||a&&a.formatNumber||t.helperMissing).call(null!=a?a:{},null!=(r=null!=a?a.photo:a)?r.commentCount:r,{name:"formatNumber",hash:{},data:l}))},3:function(e,a,t,n,l){var r;return e.escapeExpression((t.friendlyNumber||a&&a.friendlyNumber||t.helperMissing).call(null!=a?a:{},null!=(r=null!=a?a.photo:a)?r.commentCount:r,{name:"friendlyNumber",hash:{},data:l}))},compiler:[7,">= 4.0.0"],main:function(e,a,t,n,l){var r,s=null!=a?a:{},o=t.helperMissing,u=e.escapeExpression;return u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["fave-view"]:a,{name:"outlet",hash:{},data:l}))+'\n<div>\n\t<a title="Comment" class="button comment" href="#">\n\t\t<span class="ui-icon-comments">&nbsp;</span>\n\t\t<span class="button-comment-count">'+(null!=(r=t.if.call(s,null!=a?a.realFullscreen:a,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),data:l}))?r:"")+"</span>\n\t</a>\n</div>\n"+u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["share-view"]:a,{name:"outlet",hash:{},data:l}))+"\n"+u((t.outlet||a&&a.outlet||o).call(s,null!=a?a["photo-sidebar-toggle-view"]:a,{name:"outlet",hash:{},data:l}))},useData:!0}),n={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(n[a]=t)}),e.Template.register("hermes/photo-sidebar-actions",function(a,l){return l=l||{},l.partials=l.partials?e.merge(n,l.partials):n,t(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-sidebar-actions-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-sidebar-toggle-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,inlineStyling:!0,disabled:function(){return!this.appContext.flipper.isFlipped("enable-similarity-search-from-photo-page")}}},initializer:function(e){return this.photoId=e.photoId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this.isFullscreen=this.appContext.experiments.fullscreen.getMode(),this.signinPendingQueue=e.signinPendingQueue,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-engagement-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)]).then(function(e){t.set("photo-engagement",e[0]),t.set("photo",e[1])})},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("photo-sidebar-actions",{photo:e.toJSON(),realFullscreen:this.realFullscreen,"is-fullscreen":this.isFullscreen,"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):""}),this},commentClicked:function(t){var i=this;if(!t.ctrlKey){var n,o;t.preventDefault(),t.stopPropagation(),this.appContext.experiments.fullscreen.getMode()&&this.appContext.getViewer().signedIn?(setTimeout(function(){e.fire("flickr:photo-sidebar-actions-focus-comment-form")},1500),this.appContext.flapp.navigate(e.config.doc.location.href.replace("/lightbox",""))):this.appContext.getViewer().signedIn?(o=this.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"))&&o.focus():((n=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.SIGN_IN"}),cancelButtonLabel:this.intlMessage({intlName:"photo-sidebar-actions-view.CANCEL"}),htmlMessage:this.intlMessage({intlName:"photo-sidebar-actions-view.SIGN_IN_TO_COMMENT"}),appContext:this.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",function(t){e.SigninHelper.addPendingComment({id:i.photoId})}),n.show()),e.rapidTracker.beacon(this.name,"commentActionBarButtonClick")}},menuItemsOpened:function(t){this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()&&(t.preventDefault(),t.stopPropagation(),e.fire("flickr:photo-sidebar-fullscreen-expand"),65===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-gallery",t)},500):69===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-set",t)},500):71===t.keyCode?setTimeout(function(){e.fire("flickr:photo-page-open-add-group",t)},500):84===t.keyCode&&setTimeout(function(){e.fire("flickr:photo-page-open-add-tag",t)},500))},moreClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"detailedViewActionBarButtonClick")},downloadClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"downloadActionBarButtonClick")},infoClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"infoActionBarButtonClick")},activate:function(){var t,i=this.get("container"),n=this;return i&&(i.one(".comment")&&this.registerEventHandler(i.one(".comment").on("click",this.commentClicked,this)),e.on("flickr:photo-sidebar-actions-focus-comment-form",function(){n.get("container").ancestor(".photo-sidebar-view")?t=n.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"):(t=e.one(".sub-photo-comments-view textarea"))&&t.scrollIntoView(),t&&t.focus()}),this.appContext.experiments.fullscreen.getMode()&&(i.one(".more")&&this.registerEventHandler(i.one(".more").on("click",this.moreClicked,this)),i.one(".download")&&this.registerEventHandler(i.one(".download").on("click",this.downloadClicked,this)),i.one(".info")&&this.registerEventHandler(i.one(".info").on("click",this.infoClicked,this)))),this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(e){e.commentCount&&i.one(".comment span.button-comment-count").set("text",e.commentCount.newVal)})),this.attachKeyEvent("down:67",this.commentClicked.bind(this)),this.appContext.experiments.fullscreen.getMode()&&this.attachKeyEvent("down:71,65,69,84",this.menuItemsOpened.bind(this)),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-actions","fluid-modal-view","signin-helper","fluid-share-photo-view"],optional:["fave-view","photo-engagement-models"],langBundles:["photo-sidebar-actions-view","photo-page-scrappy","common"]});YUI.add("hermes-lang-photo-sidebar-actions-view",function(n,i){n.Intl.add("hermes/photo-sidebar-actions-view","en-US",{OOPS:["Oops!"],SIGN_IN_TO_COMMENT:["So you want to comment? Sign in and try again."],SIGN_IN:["Sign in"],CANCEL:["Forget it"]})},"@VERSION@",{requires:["intl"]});