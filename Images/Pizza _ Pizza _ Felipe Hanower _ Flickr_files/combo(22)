YUI.add("hermes-template-photo-page-right-size-express",function(t,e){var n=t.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(t,e,n,i,o){var a,h=null!=e?e:{},l=n.helperMissing,r=t.escapeExpression;return'\n<script type="text/javascript" nonce="'+r("function"==typeof(a=null!=(a=n.cspNonce||(null!=e?e.cspNonce:e))?a:l)?a.call(h,{name:"cspNonce",hash:{},data:o}):a)+'">\n\n\t(function(){\n\n\t\tvar PADDING_HORIZONTAL = 40;\n\n\t\twindow.getPhotoWellHeight = function () {\n\n\t\t\tvar minHeight = 500,\n\t\t\t    winWidth = window.innerWidth,\n\t\t\t    winHeight = window.innerHeight - 50,\n\t\t\t    ratioNarrow = 1,\n\t\t\t    ratioRegular = 2.3,\n\t\t\t    ratioTransitional = 2.75,\n\t\t\t    idealSubphotoHeight = 120,\n\t\t\t    breakHeightNarrow = (winWidth / ratioNarrow) + idealSubphotoHeight,\n\t\t\t    breakHeightRegular = (winWidth / ratioRegular) + idealSubphotoHeight,\n\t\t\t    breakHeightTransitional = winWidth / ratioTransitional,\n\t\t\t    newPhotoWellHeight;\n\n\t\t\tif (winHeight > breakHeightNarrow) {\n\n\t\t\t\tnewPhotoWellHeight = winWidth / ratioNarrow;\n\n\t\t\t} else if (winHeight > breakHeightRegular) {\n\n\t\t\t\tnewPhotoWellHeight = winHeight - idealSubphotoHeight;\n\n\t\t\t} else if (winHeight > breakHeightTransitional) {\n\n\t\t\t\tnewPhotoWellHeight = winHeight - idealSubphotoHeight + idealSubphotoHeight * (winHeight - breakHeightRegular) / (breakHeightTransitional - breakHeightRegular);\n\n\t\t\t} else {\n\n\t\t\t\tnewPhotoWellHeight = winHeight;\n\n\t\t\t}\n\n\t\t\treturn Math.max(minHeight, Math.round(newPhotoWellHeight));\n\n\t\t}\n\n\t\tfunction domReady () {\n\n\t\t\ttry {\n\n\t\t\t\tif (document.getElementsByClassName("low-res-photo")[0]) {\n\n\t\t\t\t\tvar photoWellView = document.getElementsByClassName("photo-well-scrappy-view")[0],\n\t\t\t\t\t    heightController = photoWellView.getElementsByClassName("height-controller")[0],\n\t\t\t\t\t    photoWellMediaView = document.getElementsByClassName("photo-well-media-scrappy-view")[0],\n\t\t\t\t\t    lowResImageElement = photoWellMediaView.getElementsByClassName("low-res-photo")[0],\n\t\t\t\t\t    photoWidth = '+r("function"==typeof(a=null!=(a=n.photoWidth||(null!=e?e.photoWidth:e))?a:l)?a.call(h,{name:"photoWidth",hash:{},data:o}):a)+",\n\t\t\t\t\t    photoHeight = "+r("function"==typeof(a=null!=(a=n.photoHeight||(null!=e?e.photoHeight:e))?a:l)?a.call(h,{name:"photoHeight",hash:{},data:o}):a)+',\n\t\t\t\t\t    photoAspectRatio = photoWidth / photoHeight,\n\t\t\t\t\t    photoWellHeight = window.getPhotoWellHeight(),\n\t\t\t\t\t    photoWellMediaViewPadding = {\n\t\t\t\t\t        top: parseInt(getComputedStyle(photoWellMediaView)[\'paddingTop\'].match(/[0-9]+/)[0], 10),\n\t\t\t\t\t        right: PADDING_HORIZONTAL,\n\t\t\t\t\t        bottom: parseInt(getComputedStyle(photoWellMediaView)[\'paddingBottom\'].match(/[0-9]+/)[0], 10),\n\t\t\t\t\t        left: PADDING_HORIZONTAL\n\t\t\t\t\t    },\n\t\t\t\t\t    canvasSize = {\n\t\t\t\t\t        height: photoWellHeight - photoWellMediaViewPadding.top - photoWellMediaViewPadding.bottom,\n\t\t\t\t\t        width: window.innerWidth - photoWellMediaViewPadding.left - photoWellMediaViewPadding.right\n\t\t\t\t\t    };\n\n\t\t\t\t\theightController.style.height = photoWellHeight + "px";\n\n\t\t\t\t\tif (photoWidth <= canvasSize.width && photoHeight <= canvasSize.height) {\n\t\t\t\t\t\tlowResImageElement.style.height = photoHeight + "px";\n\t\t\t\t\t\tlowResImageElement.style.width = photoWidth + "px";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (photoAspectRatio < 1 || Math.round(canvasSize.width / photoAspectRatio) > canvasSize.height) {\n\t\t\t\t\t\t\tlowResImageElement.style.height = canvasSize.height + "px";\n\t\t\t\t\t\t\tlowResImageElement.style.width = Math.round(canvasSize.height * photoAspectRatio) + "px";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tlowResImageElement.style.height = Math.round(canvasSize.width / photoAspectRatio) + "px";\n\t\t\t\t\t\t\tlowResImageElement.style.width = canvasSize.width + "px";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} catch (e) {\n\t\t\t\tif (window.sendRequest) {\n\t\t\t\t\twindow.sendRequest(\'flickr.hermes.photoDimensionCorrectionError\', \'There was a JS error when trying to correct a server rendered photo.\');\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tif (document.readyState != \'loading\'){\n\t\t\tdomReady();\n\t\t} else {\n\t\t\tdocument.addEventListener(\'DOMContentLoaded\', domReady);\n\t\t}\n\n\t}());\n\n<\/script>\n'},useData:!0}),i={};t.Array.each([],function(e){var n=t.Template.get("hermes/"+e);n&&(i[e]=n)}),t.Template.register("hermes/photo-page-right-size-express",function(e,o){return o=o||{},o.partials=o.partials?t.merge(i,o.partials):i,n(e,o)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-vr-overlay",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,t,s){return'<a class="close"><span></span></a>'},useData:!0}),t={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)}),e.Template.register("hermes/vr-overlay",function(a,s){return s=s||{},s.partials=s.partials?e.merge(t,s.partials):t,r(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-flickr-balls",function(e,a){var l=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,l,r,s){return'<div class="balls">\n\t<div class="blue ball"></div><div class="pink ball"></div>\n</div>'},useData:!0}),r={};e.Array.each([],function(a){var l=e.Template.get("hermes/"+a);l&&(r[a]=l)}),e.Template.register("hermes/flickr-balls",function(a,s){return s=s||{},s.partials=s.partials?e.merge(r,s.partials):r,l(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("flickr-photos-removeTag-deletor",function(o,e){"use strict";o.namespace("ModelDeletors")["flickr-photos-removeTag"]={run:function(r,t){var i={};return"string"==typeof r?i.tag_id=r:"object"==typeof r&&(i.global_tag_ids=r.globalTagIds.join(","),i.photo_ids=r.photoIds.join(",")),t.callAPI("flickr.photos.removeTag",i).then(null,o.FetcherErrorLogger(e))}}},"@VERSION@",{requires:["flickr-promise"],optional:[]});YUI.add("tag-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{create:function(e){return t.ModelCreators["flickr-photos-addTags"].run(e,this.appContext)},delete:function(e){return t.ModelDeletors["flickr-photos-removeTag"].run(e,this.appContext)}},attributes:{tagValue:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e.trim().replace(/\s/g,""))}},tagRaw:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},tagAuthorNSID:{},isMachineTag:{validator:function(e){return t.AttributeHelpers.validateBoolean(e)},setter:function(e){return t.AttributeHelpers.coerceBoolean(e)},defaultValue:!1},url:{derivedBy:["tagValue"],readOnly:!0,defaultFn:function(t){var e=this.getValue(t,"tagValue");return e?"/photos/tags/"+e:void 0}},searchUrl:{derivedBy:["tagValue","tagRaw","isMachineTag"],readOnly:!0,defaultFn:function(t){var e,r=this.getValue(t,"tagRaw"),a=this.getValue(t,"tagValue"),i=this.getValue(t,"isMachineTag");return r&&i?(r.indexOf(" ")>0&&(e=r.indexOf("=")+1,r=r.substring(0,e)+'"'+r.substring(e)+'"'),"/search/?tags="+r):a?"/search/?tags="+a:void 0}},duplicateAutotagId:{validator:function(e){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-addTags-creator","flickr-photos-removeTag-deletor"]});YUI.add("flickr-tags-getListPhoto-fetcher",function(t,o){"use strict";t.namespace("ModelFetchers")["flickr-tags-getListPhoto"]={run:function(a,e){var s=a.id,g={photo_id:s,extras:"autotags",lang:e.lang},r=this;return t.Promise.all([e.callAPI("flickr.tags.getListPhoto",g),e.getModelRegistry("photo-tags-models"),e.getModelRegistry("tag-models"),e.getModelRegistry("photo-autotags-models"),e.getModelRegistry("autotag-models")]).then(function(t){return r._processResponse(t,s,e.flipper)},t.FetcherErrorLogger(o))},_processResponse:function(o,a,e){var s,g=o[0],r=o[1],i=o[2],n=g.photo&&g.photo.tags&&void 0!==g.photo.tags.tag?g.photo.tags.tag.length:0,p=[],u=o[3],d=o[4],h=0,l=[];return n>0&&t.Array.each(g.photo.tags.tag,function(t){"string"==typeof t.content&&p.push(i.addOrUpdate({id:t.id,tagRaw:t.raw,tagValue:t.content,tagAuthorNSID:t.author,isMachineTag:t.machineTag,duplicateAutotagId:t.duplicateAutotag}))}),r.exists(a)?r.setValue(a,"tags",p):r.add({id:a,tags:p}),s={id:a},g.photo&&g.photo.autotags&&void 0!==g.photo.autotags.autotag&&(h=g.photo.autotags.autotag.length),h>0&&t.Array.each(g.photo.autotags.autotag,function(t){"string"==typeof t.content&&l.push(d.addOrUpdate({id:t.id,autotagValue:t.content,score:t.confidence,isPrivate:t.private}))}),s.autotags={page:1,perPage:1e3,pageContent:l,totalItems:h},u.exists(a)?u.setValue(a,"autotags",s.autotags):u.add(s),r.proxy(a)}}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["tag-models","photo-tags-models"]});YUI.add("photo-tags-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ModelFetchers["flickr-tags-getListPhoto"].run(e,this.appContext)},create:function(e){return t.ModelCreators["flickr-photos-addTags"].run(e,this.appContext)},delete:function(e){return t.ModelDeletors["flickr-photos-removeTag"].run(e,this.appContext)}},attributes:{tags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-tags-getListPhoto-fetcher","flickr-photos-addTags-creator","flickr-photos-removeTag-deletor"]});